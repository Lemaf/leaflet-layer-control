L.Control.LC=L.Control.extend({includes:L.Mixin.Events,options:{position:"bottomright",layers:{showAreas:!0,formatArea:function(t){return t>=1e3?L.Util.formatNum(t/1e4,4)+"ha":L.Util.formatNum(t,4)+"m"},groups:[]},parentElement:null},initialize:function(t){var e=L.extend({},this.options.layers,t&&t.layers);t=L.extend({},this.options,t||{},{layers:e}),L.Control.prototype.initialize.call(this,t)},addLayer:function(t){return this._toInvoke("addLayer",t),this},addLegend:function(t){return this._toInvoke("addLegend",t),this},hideLayer:function(t){return this._toInvoke("hideLayer",t),this},showLayer:function(t){return this._toInvoke("showLayer",t),this},onAdd:function(t){this._viewLayers=L.Control.LC.viewLayers(t,this.options.layers);var e=L.DomUtil.create("div","llc llc-button");return L.DomEvent.on(e,"click",this._onButtonClick,this).on(e,"click",L.DomEvent.stop).on(e,"dblclick",L.DomEvent.stop).on(e,"mousedown",L.DomEvent.stop),this._invokeInvokes(),this._map.eachLayer(function(t){this._viewLayers.addLayer(t,!0)},this),e},updateAreas:function(){return this._toInvoke("updateAreas"),this},_invokeInvoke:function(t){this._viewLayers&&this._viewLayers[t.method].apply(this._viewLayers,t.args)},_invokeInvokes:function(){if(this._invokes)for(var t=0;t<this._invokes.length;t++)this._invokeInvoke(this._invokes[t])},_onButtonClick:function(){this.getPosition();this._viewLayers.show(this._container,this.getPosition())},_toInvoke:function(t){var e=Array.prototype.slice.call(arguments,1);this._invokes||(this._invokes=[]);var i={method:t,args:e};this._invokes.push(i),this._invokeInvoke(i)}}),L.Control.lc=function(t){return new L.Control.LC(t)},function(){function t(t){var i,o,s=0;if(t.length>2){for(var a=0;a<t.length;a++)i=t[a],o=t[(a+1)%t.length],s+=(o.lng-i.lng)*e*(2+Math.sin(i.lat*e)+Math.sin(o.lat*e));s*=n}return s}var e=L.LatLng.DEG_TO_RAD,i=6378137,o=6356752,n=i*o/2;L.Control.LC.areaOf=function(e,i){var o=0;if(e instanceof L.FeatureGroup)e.eachLayer(function(t){o+=L.Control.LC.areaOf(t)});else if(e instanceof L.Polygon){var n=e.getLatLngs();Array.isArray(n[0])?(o+=t(n[0]),n.slice(0).forEach(function(e){o-=t(e)})):o=t(n)}return o}}(),L.Control.LC.ViewLayers=L.Class.extend({includes:L.Mixin.Events,initialize:function(t,e){this._map=t,L.setOptions(this,e);var i=this._containerEl=L.DomUtil.create("div","llc-container");L.extend(i.style,{overflow:"hidden"});var o=this._canvasEl=L.DomUtil.create("div","llc-canvas",i),n=this._headerEl=L.DomUtil.create("div","llc-header",o),s=this._closeEl=L.DomUtil.create("div","llc-close",n);this._groupsRootEl=L.DomUtil.create("div","llc-groups",o),this.options.groups&&this.options.groups.forEach(this._addGroup,this),t.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this),L.DomEvent.on(i,"click",L.DomEvent.stopPropagation).on(i,"dblclick",L.DomEvent.stopPropagation).on(i,"mousedown",L.DomEvent.stopPropagation).on(s,"click",this._onCloseClick,this),this._layers={},this._hidedLayers=[]},addLayer:function(t,e){if(t.options){var i=L.stamp(t);if(!this._layers[i]){var o=this._layers[i]={layer:t},n=-1===this._hidedLayers.indexOf(i),s=this._getGroup(t.options.group);n||this._maybeHideGroup(s);var a=L.DomUtil.create("li","llc-item",n&&s.el),r=L.DomUtil.create("div","llc-item-legend",a),l=L.DomUtil.create("input","llc-item-visibility",a),h=L.DomUtil.create("label","llc-item-opacity-label",a);if(l.id="llc-"+L.stamp(l),h.setAttribute("for",l.id),h.innerHTML=t.options.title,a._layerID=i,o.group=s,o.liEl=a,o.legendEl=r,o.visibilityCheckEl=l,l._layerID=i,s.unique?(l.type="radio",l.name=s.name):l.type="checkbox",L.DomEvent.on(a,"click",this._onItemClick,this).on(l,"click",this._onItemVisibilityCheck,this),t.setOpacity){var c=L.DomUtil.create("input","llc-item-opacity",a);c.type="range",c.min=0,c.max=100,c._layerID=i,o.opacityEl=c,L.DomEvent.on(c,"change",this._onOpacityChange,this)}if(this.options.showAreas&&(t instanceof L.Polygon||t instanceof L.FeatureGroup)){var d=L.DomUtil.create("span","llc-item-area",a);o.areaEl=d}}return e||(this._layers[i].user=!0),this._layers[i].inMap=this._map.hasLayer(t),this}},addLegend:function(t){if(Array.isArray(t))t.forEach(this.addLegend,this);else{this.addLayer(t.layer);var e=this._layers[L.stamp(t.layer)];L.extend(e.legendEl.style,t.style)}return this},close:function(){this._visible&&this._close()},hideLayer:function(t){var e=L.stamp(t);-1===this._hidedLayers.indexOf(e)&&this._hidedLayers.push(e);var i;(i=this._layers[e])&&i.liEl.parentNode&&(i.liEl.parentNode.removeChild(i.liEl),this._maybeHideGroup(i.group))},removeLayer:function(t,e){var i=L.stamp(t),o=this._layers[i];o&&(delete o.inMap,e&&(o.liEl.parentNode.removeChild(o.liEl),delete this._layers[i]))},show:function(t,e){this._visible||(this._visible=!0,this._show(t,e))},updateAreas:function(){var t;for(var e in this._layers)t=this._layers[e],t.areaEl&&(t.areaEl.innerHTML=this.options.formatArea(L.Control.LC.areaOf(t.layer,!0)))},_addGroup:function(t){if(this._groups||(this._groups={},this._groupsOrder=[]),!this._groups[t.name]){var e=this._groups[t.name]={name:t.name,unique:!!t.unique,el:L.DomUtil.create("ul","llc-group",this._groupsRootEl)};this._groupsOrder.push(e);var i=L.DomUtil.create("li","llc-group-title",e.el),o=L.DomUtil.create("span",null,i);o.innerHTML=t.name}},_close:function(){delete this._visible,this._containerEl.parentNode.removeChild(this._containerEl),this._fromEl.style.display="block"},_getGroup:function(t){this._groups||(this._groups={});var e=this._groups[t];return e||(this._addGroup({name:"default"}),e=this._groups["default"]),e},_maybeHideGroup:function(t){t.showAlways||1!==t.el.childNodes.length||t.el.parentNode.removeChild(t.el)},_onCloseClick:function(t){this.close()},_onLayerAdd:function(t){this.addLayer(t.layer,!0)},_onLayerRemove:function(t){this.removeLayer(t.layer)},_onItemClick:function(t){},_onItemVisibilityCheck:function(t){var e=this._layers[t.currentTarget._layerID];if(e){var i,o=e.group;if(o.unique){if(e.inMap)return;for(var n in this._layers)i=this._layers[n],i!==e&&i.group===o&&i.inMap&&this._map.removeLayer(i.layer);this._map.addLayer(e.layer)}else e.inMap?this._map.removeLayer(e.layer):this._map.addLayer(e.layer)}},_onOpacityChange:function(t){var e=parseInt(t.target.value)/100,i=this._layers[t.target._layerID];i&&i.layer.setOpacity(e)},_show:function(t,e){L.extend(this._canvasEl.style,{opacity:0});var i={};0===e.indexOf("bottom")?i.bottom=t.offsetParent.offsetHeight-(t.offsetTop+t.offsetHeight)+"px":i.top=t.offsetTop+"px",e.indexOf("right")>=0?i.right=t.offsetParent.offsetWidth-(t.offsetLeft+t.offsetWidth)+"px":i.left=t.offsetLeft+"px",this._cssPosition=i,L.extend(this._containerEl.style,{height:t.offsetHeight+"px",position:"absolute",width:t.offsetWidth+"px"},this._cssPosition),t.parentNode.appendChild(this._containerEl),t.style.display="none",this._fromEl=t,this._containerEl.style.background="#ffffff";var o=this._containerEl.animate([{height:t.offsetHeight+"px",width:t.offsetWidth+"px"},{height:this._containerEl.scrollHeight+"px",width:this._containerEl.scrollWidth+"px",easing:"ease-in-out"}],500);L.DomEvent.on(o,"finish",function(){L.extend(this._containerEl.style,{height:this._containerEl.scrollHeight+"px",width:this._containerEl.scrollWidth+"px"})},this),o=this._canvasEl.animate([{opacity:0},{opacity:1}],500),L.DomEvent.on(o,"finish",function(){L.extend(this._canvasEl.style,{opacity:1})},this)}}),L.Control.LC.viewLayers=function(t,e){return new L.Control.LC.ViewLayers(t,e)};